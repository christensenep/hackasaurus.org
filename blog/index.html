<!DOCTYPE html>
<meta charset="utf-8">
<title>Hackasaurus Blog</title>
<link rel="alternate" type="application/rss+xml" title="Hackasaurus Blog" href="http://pipes.yahoo.com/pipes/pipe.run?_id=acd9b281e46ad78b6c34873ba277626c&_render=rss">
<style>
@import url('/css/base.css');

div#blog, div#container {
  background: white;
}

div.entries {
  padding-top: 1em;
  padding-bottom: 1em;
  width: 40em;
  margin: 0 auto;
}

div.entry div.author {
  font-style: italic;
}

div.entry div.author:before {
  content: "By ";
}

div.entry h2.title a {
  text-decoration: none;
}

div.entry h2.title a:hover {
  text-decoration: underline;
}
</style>
<script src="/js/jquery.min.js"></script>
<script src="/js/apply-page-template.js"></script>
<script>
$(window).ready(function() {
  var feedURL = "http://pipes.yahoo.com/pipes/pipe.run?_id=acd9b281e46ad78b6c34873ba277626c&_render=json";
  var blogLoaded = jQuery.Deferred();
  var entryTemplate = $("#templates .entry");
  var entries = $('<div class="entries"></div>');

  pageLoaders.push(blogLoaded);
  jQuery.getJSON(feedURL, function(data) {
    $(document.body).append(entries);
    entries.hide();

    var images = [];
    var maxWidth = entries.width();

    data.value.items.forEach(function(item) {
      var entry = entryTemplate.clone();
      entry.find(".title a").text(item['y:title']);
      entry.find(".title a").attr("href", item['link']);
      entry.find(".author").text(item['dc:creator']);
      entry.find(".content").html(item['content:encoded']);

      var imageLoaded = jQuery.Deferred();

      images.push(imageLoaded);
      entry.find(".content img").load(function onImgLoad() {
        $(this).unbind("load", onImgLoad);
        var width = $(this).width();
        if (width > maxWidth) {
          $(this).height($(this).height() * (maxWidth / width));
          $(this).width(maxWidth);
        }
        imageLoaded.resolve();
      }).each(function() {
        if (this.complete)
          $(this).trigger("load");
      });
      entries.append(entry);
    });

    jQuery.when.apply(jQuery, images).then(function() {
      blogLoaded.resolve();
    });
  });

  $(window).bind("beforepagedisplay", function() {
    $("#blog").append(entries);
    entries.show();
  });
});
</script>
<div id="blog"></div>
<div id="templates">
  <div class="entry">
    <h2 class="title"><a></a></h2>
    <div class="author"></div>
    <div class="content"></div>
  </div>
</div>
